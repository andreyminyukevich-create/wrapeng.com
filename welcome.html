<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Keep1R CRM ‚Äî –í—Ö–æ–¥</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --font: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
  --bg:           #eef2f9;
  --surface:      #ffffff;
  --border:       rgba(15,23,42,0.09);
  --text:         #0f172a;
  --text-muted:   #64748b;
  --text-dim:     #94a3b8;
  --primary:      #2563eb;
  --primary-dark: #1d4ed8;
  --primary-bg:   rgba(37,99,235,0.07);
  --danger:       #dc2626;
  --radius:       16px;
  --radius-sm:    10px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
  min-height: 100%;
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
}
body {
  display: flex;
  flex-direction: column;
}
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 900px 600px at 20% -10%, rgba(37,99,235,0.07) 0%, transparent 55%),
    radial-gradient(ellipse 700px 500px at 80% 110%, rgba(37,99,235,0.05) 0%, transparent 55%);
  pointer-events: none;
}

/* ‚îÄ‚îÄ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚îÄ‚îÄ */
.page {
  position: relative; z-index: 1;
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px 24px;
}

/* –±—Ä–µ–Ω–¥ */
.brand-header {
  text-align: center;
  margin-bottom: 24px;
}
.brand-name {
  font-size: 0.72rem;
  font-weight: 700;
  color: var(--primary);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  margin-bottom: 10px;
}
.brand-tagline {
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--text);
  letter-spacing: -0.4px;
  line-height: 1.25;
  margin-bottom: 7px;
}
.brand-sub {
  font-size: 0.85rem;
  color: var(--text-muted);
  line-height: 1.55;
}

/* —Ñ–∏—á–∏ */
.features-row {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
  width: 100%;
  max-width: 440px;
}
.feat {
  flex: 1;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 11px 6px;
  text-align: center;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.feat-icon  { font-size: 1.1rem; margin-bottom: 4px; }
.feat-label { font-size: 0.62rem; font-weight: 600; color: var(--text-muted); line-height: 1.3; }

/* –∫–∞—Ä—Ç–æ—á–∫–∞ */
.auth-card {
  width: 100%;
  max-width: 420px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 28px 28px 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05), 0 12px 40px rgba(0,0,0,0.08);
}

/* —Ç–∞–±—ã */
.auth-tabs {
  display: flex;
  gap: 3px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 3px;
  margin-bottom: 22px;
}
.auth-tab {
  flex: 1;
  padding: 9px 6px;
  border-radius: 8px;
  border: none;
  font-family: var(--font);
  font-size: 0.81rem;
  font-weight: 700;
  cursor: pointer;
  background: transparent;
  color: var(--text-muted);
  transition: all 0.15s;
}
.auth-tab.active {
  background: var(--primary);
  color: #fff;
  box-shadow: 0 2px 8px rgba(37,99,235,0.25);
}

/* —ç–∫—Ä–∞–Ω—ã */
.screen { display: none; }
.screen.active { display: block; animation: fadeUp 0.2s ease; }
@keyframes fadeUp {
  from { opacity:0; transform:translateY(7px); }
  to   { opacity:1; transform:translateY(0); }
}
.screen-title {
  font-size: 1.05rem;
  font-weight: 700;
  margin-bottom: 2px;
  letter-spacing: -0.2px;
}
.screen-sub {
  font-size: 0.78rem;
  color: var(--text-muted);
  margin-bottom: 18px;
  line-height: 1.5;
}

/* —Ñ–æ—Ä–º–∞ */
.form-group { margin-bottom: 10px; }
.form-group label {
  display: block;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 4px;
  letter-spacing: 0.02em;
}
.form-group input {
  width: 100%;
  padding: 10px 13px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-family: var(--font);
  font-size: 16px;
  color: var(--text);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
  -webkit-appearance: none;
}
.form-group input::placeholder { color: var(--text-dim); }
.form-group input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37,99,235,0.10);
  background: var(--surface);
}

/* –∫–Ω–æ–ø–∫–∏ */
.btn {
  width: 100%;
  padding: 12px;
  border-radius: var(--radius-sm);
  border: none;
  font-family: var(--font);
  font-size: 0.87rem;
  font-weight: 700;
  cursor: pointer;
  margin-top: 7px;
  transition: all 0.15s;
  display: block;
  text-align: center;
  text-decoration: none;
  -webkit-appearance: none;
}
.btn:disabled { opacity: 0.55; cursor: not-allowed; }
.btn-primary {
  background: var(--primary);
  color: #fff;
  box-shadow: 0 2px 10px rgba(37,99,235,0.22);
}
.btn-primary:hover:not(:disabled) { background: var(--primary-dark); transform: translateY(-1px); }
.btn-primary:active:not(:disabled) { transform: translateY(0); }
.btn-outline {
  background: transparent;
  color: var(--text-muted);
  border: 1px solid var(--border);
}
.btn-outline:hover:not(:disabled) { background: var(--bg); color: var(--text); }

/* –æ—à–∏–±–∫–∏ */
.error-msg {
  display: none;
  background: rgba(220,38,38,0.07);
  border: 1px solid rgba(220,38,38,0.18);
  color: var(--danger);
  border-radius: var(--radius-sm);
  padding: 9px 12px;
  font-size: 0.77rem;
  font-weight: 600;
  margin-bottom: 12px;
  line-height: 1.4;
}

.auth-footer {
  text-align: center;
  margin-top: 14px;
  font-size: 0.76rem;
  color: var(--text-muted);
}
.auth-footer a { color: var(--primary); text-decoration: none; font-weight: 700; }
.auth-footer a:hover { text-decoration: underline; }

.consent-note {
  font-size: 0.67rem;
  color: var(--text-dim);
  text-align: center;
  margin-top: 12px;
  line-height: 1.55;
}
.consent-note a { color: var(--text-muted); text-decoration: underline; }

/* —Å—Ç–∞—Ç—É—Å */
.status-box {
  border-radius: var(--radius-sm);
  padding: 18px;
  text-align: center;
  margin-bottom: 14px;
  border: 1px solid var(--border);
}
.status-box.purple { background: rgba(124,58,237,0.06); border-color: rgba(124,58,237,0.15); }
.status-box.amber  { background: rgba(217,119,6,0.07); border-color: rgba(217,119,6,0.18); }
.status-icon  { font-size: 1.9rem; margin-bottom: 7px; }
.status-title { font-size: 0.92rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.status-desc  { font-size: 0.78rem; color: var(--text-muted); line-height: 1.5; }

.creds-box {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 11px 14px;
  margin-bottom: 12px;
}
.creds-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.79rem;
}
.creds-row:last-child { border-bottom: none; }
.creds-label { color: var(--text-muted); font-weight: 600; }
.creds-value { color: var(--text); font-weight: 700; }

/* –º–æ–±–∏–ª–∫–∞ */
@media (max-width: 480px) {
  .page { padding: 32px 16px 16px; justify-content: flex-start; }
  .brand-tagline { font-size: 1.35rem; }
  .features-row { display: none; }
  .auth-card { padding: 22px 18px 20px; }
}
@media (min-width: 481px) {
  .features-row { display: flex; }
}
</style>
</head>
<body>
<div class="page">

  <div class="brand-header">
    <div class="brand-name">Keep1R CRM</div>
    <div class="brand-tagline">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–µ–π–ª–∏–Ω–≥-—Å—Ç—É–¥–∏–µ–π</div>
    <div class="brand-sub">–†–∞—Å—á—ë—Ç—ã, –∑–∞–∫–∞–∑—ã, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –∑–∞—Ä–ø–ª–∞—Ç—ã<br>–≤ –æ–¥–Ω–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ</div>
  </div>

  <div class="features-row">
    <div class="feat"><div class="feat-icon">üßÆ</div><div class="feat-label">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–∫–ª–µ–π–∫–∏</div></div>
    <div class="feat"><div class="feat-icon">üîß</div><div class="feat-label">–î–æ—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤</div></div>
    <div class="feat"><div class="feat-icon">üë•</div><div class="feat-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div></div>
    <div class="feat"><div class="feat-icon">üí∞</div><div class="feat-label">–ó–∞—Ä–ø–ª–∞—Ç—ã</div></div>
    <div class="feat"><div class="feat-icon">üìÑ</div><div class="feat-label">PDF-—ç–∫—Å–ø–æ—Ä—Ç</div></div>
  </div>

  <div class="auth-card">
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="showTab('login')">–í–æ–π—Ç–∏</button>
      <button class="auth-tab" onclick="showTab('register')">–ó–∞—è–≤–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø</button>
    </div>

    <div id="screen-login" class="screen active">
      <div class="screen-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üëã</div>
      <div class="screen-sub">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞</div>
      <div class="error-msg" id="login-error"></div>
      <form id="login-form">
        <div class="form-group"><label>Email</label><input type="email" id="login-email" placeholder="studio@example.com" required autocomplete="email"></div>
        <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password"></div>
        <button type="submit" class="btn btn-primary" id="login-btn">–í–æ–π—Ç–∏ ‚Üí</button>
        <button type="button" class="btn btn-outline" onclick="showTab('forgot')">–ó–∞–±—ã–ª –ø–∞—Ä–æ–ª—å</button>
      </form>
      <div class="auth-footer">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞? <a href="#" onclick="showTab('register')">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</a></div>
    </div>

    <div id="screen-register" class="screen">
      <div class="screen-title">–ó–∞—è–≤–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø üìã</div>
      <div class="screen-sub">–°–≤—è–∂–µ–º—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –∏ –æ—Ç–∫—Ä–æ–µ–º –¥–æ—Å—Ç—É–ø</div>
      <div class="error-msg" id="reg-error"></div>
      <form id="reg-form">
        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏</label><input type="text" id="reg-studio" placeholder="–°—Ç—É–¥–∏—è –æ–∫–ª–µ–π–∫–∏" required></div>
        <div class="form-group"><label>–ì–æ—Ä–æ–¥</label><input type="text" id="reg-city" placeholder="–ú–æ—Å–∫–≤–∞" required></div>
        <div class="form-group"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="reg-phone" placeholder="+7 900 000-00-00" required></div>
        <div class="form-group"><label>Email</label><input type="email" id="reg-email" placeholder="studio@example.com" required autocomplete="email"></div>
        <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="reg-password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required autocomplete="new-password" minlength="6"></div>
        <button type="submit" class="btn btn-primary" id="reg-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É ‚Üí</button>
      </form>
      <div class="consent-note">
        –û—Ç–ø—Ä–∞–≤–ª—è—è –∑–∞—è–≤–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
        <a href="user-agreement.html" target="_blank">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º</a>,
        <a href="privacy-policy.html" target="_blank">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        –∏ <a href="consent.html" target="_blank">–°–æ–≥–ª–∞—Å–∏–µ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î–Ω</a>
      </div>
      <div class="auth-footer">–ï—Å—Ç—å –¥–æ—Å—Ç—É–ø? <a href="#" onclick="showTab('login')">–í–æ–π—Ç–∏</a></div>
    </div>

    <div id="screen-forgot" class="screen">
      <div class="screen-title">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è üîë</div>
      <div class="screen-sub">–û—Ç–ø—Ä–∞–≤–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à email</div>
      <div class="error-msg" id="forgot-error"></div>
      <form id="forgot-form">
        <div class="form-group"><label>Email</label><input type="email" id="forgot-email" placeholder="studio@example.com" required></div>
        <button type="submit" class="btn btn-primary" id="forgot-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ ‚Üí</button>
        <button type="button" class="btn btn-outline" onclick="showTab('login')">‚Üê –ù–∞–∑–∞–¥</button>
      </form>
    </div>

    <div id="screen-success" class="screen">
      <div class="status-box purple">
        <div class="status-icon">üì¨</div>
        <div class="status-title">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</div>
        <div class="status-desc">–°–≤—è–∂–µ–º—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email<br>–≤ —Ç–µ—á–µ–Ω–∏–µ <strong>24 —á–∞—Å–æ–≤</strong></div>
      </div>
      <div class="creds-box">
        <div class="creds-row"><span class="creds-label">Email</span><span class="creds-value" id="success-email">‚Äî</span></div>
        <div class="creds-row"><span class="creds-label">–¢–µ–ª–µ—Ñ–æ–Ω</span><span class="creds-value" id="success-phone">‚Äî</span></div>
      </div>
      <a href="https://t.me/PPFKeep1R" target="_blank" class="btn btn-primary">‚úàÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram</a>
      <div class="auth-footer"><a href="#" onclick="showTab('login')">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫–æ –≤—Ö–æ–¥—É</a></div>
    </div>

    <div id="screen-pending" class="screen">
      <div class="status-box amber">
        <div class="status-icon">‚è≥</div>
        <div class="status-title">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
        <div class="status-desc">–û–±—ã—á–Ω–æ –¥–æ 24 —á–∞—Å–æ–≤. –•–æ—Ç–∏—Ç–µ —É—Å–∫–æ—Ä–∏—Ç—å?</div>
      </div>
      <a href="https://t.me/PPFKeep1R" target="_blank" class="btn btn-primary" style="margin-bottom:8px">‚úàÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram</a>
      <button class="btn btn-outline" onclick="logoutPending()">–í—ã–π—Ç–∏</button>
    </div>
  </div>
</div>

<script src="footer.js"></script>
<script>
(function() {
'use strict';
const SB_URL = 'https://hdghijgrrnzmntistdvw.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkZ2hpamdycm56bW50aXN0ZHZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMzMyNzksImV4cCI6MjA3NTYwOTI3OX0.D9EDTmVrFRVp0B8_5tCJM29gbFdtadsom0Ihsf4uQ8Q';
const sb = window.supabase.createClient(SB_URL, SB_KEY, {auth:{persistSession:true,autoRefreshToken:true}});
window._crmSb = sb;

window.showTab = function(tab) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  const map = {login:'screen-login',register:'screen-register',forgot:'screen-forgot',success:'screen-success',pending:'screen-pending'};
  document.getElementById(map[tab]||'screen-login')?.classList.add('active');
  if (tab==='login')    document.querySelectorAll('.auth-tab')[0]?.classList.add('active');
  if (tab==='register') document.querySelectorAll('.auth-tab')[1]?.classList.add('active');
};

function err(id, msg) { const e=document.getElementById(id); if(e){e.textContent=msg;e.style.display='block';} }
function clr(id) { const e=document.getElementById(id); if(e) e.style.display='none'; }

async function checkSession() {
  const {data:{session}} = await sb.auth.getSession();
  if (!session) return;
  const {data:m} = await sb.from('studio_members').select('studio_id,studios(subscription_tier)').eq('user_id',session.user.id).eq('is_active',true).single();
  if (!m) return;
  if (m.studios?.subscription_tier === 'pending') { showTab('pending'); return; }
  window.location.href = 'dashboard.html';
}

document.getElementById('login-form').addEventListener('submit', async e => {
  e.preventDefault(); clr('login-error');
  const btn=document.getElementById('login-btn'); btn.disabled=true; btn.textContent='–í—Ö–æ–¥–∏–º...';
  try {
    const {data,error} = await sb.auth.signInWithPassword({
      email: document.getElementById('login-email').value.trim(),
      password: document.getElementById('login-password').value
    });
    if (error) throw error;
    const {data:m} = await sb.from('studio_members').select('studios(subscription_tier)').eq('user_id',data.user.id).eq('is_active',true).single();
    if (m?.studios?.subscription_tier === 'pending') { showTab('pending'); }
    else window.location.href = 'dashboard.html';
  } catch(e) {
    const msgs={'Invalid login credentials':'–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å','Email not confirmed':'–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email'};
    err('login-error', msgs[e.message]||e.message);
  } finally { btn.disabled=false; btn.textContent='–í–æ–π—Ç–∏ ‚Üí'; }
});

document.getElementById('reg-form').addEventListener('submit', async e => {
  e.preventDefault(); clr('reg-error');
  const btn=document.getElementById('reg-btn'); btn.disabled=true; btn.textContent='–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
  const studio=document.getElementById('reg-studio').value.trim();
  const city=document.getElementById('reg-city').value.trim();
  const phone=document.getElementById('reg-phone').value.trim();
  const email=document.getElementById('reg-email').value.trim();
  const pass=document.getElementById('reg-password').value;
  if (phone.length < 10) { err('reg-error','–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'); btn.disabled=false; btn.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É ‚Üí'; return; }
  try {
    const {data:auth,error:ae} = await sb.auth.signUp({email,password:pass});
    if (ae) throw ae;
    const uid = auth.user?.id;
    if (!uid) throw new Error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
    if (auth.user?.identities?.length === 0) throw new Error('–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –í–æ–π–¥–∏—Ç–µ –∏–ª–∏ —Å–±—Ä–æ—Å—å—Ç–µ –ø–∞—Ä–æ–ª—å.');
    const refCode = Math.random().toString(36).substring(2,10).toUpperCase();
    const {data:studioData,error:se} = await sb.from('studios').insert({
      name: studio, owner_id: uid, subscription_tier: 'pending',
      referral_code: refCode, settings: {phone, city, contact_email: email}
    }).select('id').single();
    if (se) {
      const { error: reqErr } = await sb.from('access_requests').insert({studio_name:studio,city,phone,email,supabase_user_id:uid,status:'new'});
      if (reqErr) { err('reg-error','–û—à–∏–±–∫–∞: '+(se.message||'–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑')); await sb.auth.signOut(); btn.disabled=false; btn.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É ‚Üí'; return; }
      await sb.auth.signOut();
      document.getElementById('success-email').textContent=email;
      document.getElementById('success-phone').textContent=phone;
      showTab('success'); return;
    }
    await sb.from('studio_members').insert({studio_id:studioData.id,user_id:uid,role:'owner',is_active:true});
    await sb.auth.signOut();
    document.getElementById('success-email').textContent=email;
    document.getElementById('success-phone').textContent=phone;
    showTab('success');
  } catch(e) {
    err('reg-error', e.message==='User already registered'?'–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω':e.message);
  } finally { btn.disabled=false; btn.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É ‚Üí'; }
});

document.getElementById('forgot-form').addEventListener('submit', async e => {
  e.preventDefault();
  const btn=document.getElementById('forgot-btn'); btn.disabled=true; btn.textContent='–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
  try {
    const {error}=await sb.auth.resetPasswordForEmail(document.getElementById('forgot-email').value.trim(),{redirectTo:location.origin+'/welcome.html'});
    if (error) throw error;
    alert('‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!'); showTab('login');
  } catch(e) { err('forgot-error',e.message); }
  finally { btn.disabled=false; btn.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ ‚Üí'; }
});

window.logoutPending = async function() { await sb.auth.signOut(); showTab('login'); };
checkSession();
})();
</script>
</body>
</html>
